<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Clean Code - Prato NV</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">
		<link rel="stylesheet" href="css/prato.css">

		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Clean code</h1>
					<h3></h3>
					<blockquote style="background-color: white;">
						<img src="img/logo.png"/>
					</blockquote>
					<p>
						<small>
							Prato NV<br/>

							<span style="font-size: 11pt;">

								Wouter Groeneveld &amp; Luk Weyens<br/>
								22/09/2016
							</span>
						</small>
					</p>
				</section>
				<section>
					<h2>Introductie</h2>
					
					<p>
						<strong>GSM Uit</strong> aub
					</p>
					<p>
						<strong>Verstand Aan</strong> aub<br/>
						Vragen stellen toegelaten!
					</p>
				</section>

				<section>
					<section>
						<h2>Inhoudsopgave</h2>
					</section>
					<section>
					<ol>
					<li>Clean code: definities</li>
					<li>Clean code: principes</li>
					<li>Unit testing: definities</li>
					<li>Unit testing: voorbeelden</li>
					</ol>
					</section>
				</section>

				<section><h2>Clean code deel 1: <br/>definitie</h2></section>
				<section>
					<section>
					Wat is clean code?
						<blockquote>
						Clean code is code that is easy to understand and easy to change.
						</blockquote>
					</section>
					<section>
						Wat is <b>niet</b> clean code?
						<pre><code>
			function process($obj, $continue = FALSE) {
				// echo "starting the process";
				if($obj->generate() == NULL) {
					return -1;
				}
				$result = $obj->generate();
				if($continue) {
					return $result->generate();
				}
				return $result;
			}
						</code></pre>
					</section>
					<section>
						Wat is <b>wel</b> clean code?
						<pre><code>
	function getBookByISBN($isbn) {
		$book = array_search($isbn, $this->books);
		if($book == FALSE) {
			throw new BookNotFoundException("book was not found!");
		}
		return $book;
	}
						</code></pre>
					</section>
					<section>
					<img src="img/whocares.jpg"/>
					</section>
				</section>
				<section>
					<h4>Leesbaarheid!</h4>

					<blockquote>
Code gets read a lot (at least whenever
someone is writing more code), so any school
of clean code should emphasize readability.
Cleaning up a little wherever you go is
required to keep code clean.
					</blockquote>
				</section>

				<section>
					<h4>Meetbaarheid: <br/>"aantal WTFs per minuut"</h4>
					<img src="img/wtfsperminute.jpg" style="border: 4px solid lightgrey;" />
				</section>

				<section><h2>Clean code deel 2:<br/>principes</h2></section>
				<section>
					<h4>1. Naamgeving: <br/>wat is de ideale naamgeving?</h4>
					<ul>
						<li>Het moet correct weerspiegelen <strong>waar het voor dient</strong></li>
						<li>Het leunt aan bij de <strong>taal</strong> die gesproken wordt in het <strong>domein</strong></li>
					</ul>
				</section>
				<section>
					<h4>1. Naamgeving: methods/variabelen</h4>
					<pre><code>
$result = $processor->process();
					</code></pre>
					VS
					<pre><code>
$order = $library->checkOut();
					</code></pre>
				</section>
				<section>
					<section>
						<h4>1. Naamgeving: comments</h4>
						<img src="img/codecomments.jpg"/>
					</section>
					<section>
						<h4>1. Naamgeving: comments</h4>
						<pre><code>
	/**
	 *
	 * Prolong the book
	 *
	 * @param    Book  		$i The book to prolong
	 * @param    DateTime  		$j The date to prolong to
	 * @param    Person		$k The person to prolong the book to
	 * @return   nothing if OK
	 *
	 */
	function prolong($i, $j, $k) {
		//Check if this book has been checked out by the same person
		if($i->person != $k)
			//BUSTED!
			return "This is not a book you checked out."
		else
			//Everything OK, prolong the book
			$book->checkOutDate = $date;
	}
						</code></pre>
					</section>
					<section>
						<h4>1. Naamgeving: comments</h4>
						<pre><code>
	function prolong($book, $date, $person) {
		if(!$book->isCheckedOutBy($person))
			return "This is not a book you checked out."
		else
			$book->checkOutDate = $date;
	}
						</code></pre>
					</section>
				</section>

				<section>
					<h4>2. Functies: <br/>wat is een ideale functie?</h4>
				</section>
				<section>
					<h4>2. Functies: verantwoordelijkheden</h4>
					<pre><code>
class Book {
	function prolong($date, $person) {
		// does only one thing: prolonging the book
	}
}
					</code></pre>					
				</section>
				<section>
					<h4>2. Functies: argumenten</h4>
					<pre><code>
function checkoutBook($title, $isbn, $person, $enoughCredit = FALSE) {
	// ...
}
					</code></pre>
					VS
					<pre><code>
class Person {
	function checkoutBook($book) {
		// ...
	}
}
					</code></pre>										
				</section>

				<section data-background="img/sideeffects.png">
					<h4>2. Functies: Side effects</h4>
					<pre><code>
function prolong($date, $person) {
	if($this->isOverDue()){
		$person->credit -= 10;
	}
}
					</code></pre>															
				</section>

				<section>
					<section data-background="img/lab1.jpg">
						<h2>oefeningen deel 1</h2>
					</section>
					<section>
						<h4>Oefeningen deel 1: story 1</h4>
						<ul>
						<li>Gegeven: <strong>Empire</strong>, <strong>Sith</strong>, <strong>Jedi</strong> classes vol funcs. </li>
						<li>Uw taak: verduidelijken! Wat doet wat? Naamgeving!</li>
						<li>Unit testen <span style="color: lightgreen;">groen houden</span>! (<span class="inlinecode">cmd: > phpunit tests</span>)</li>
						</ul>
					</section>
					<section>
						<h4>PHPUNIT - recap</h4>
						live demo<br/>
						<img src="img/phpunit.png"/>

						<a href="https://phpunit.de/manual/current/en/appendixes.assertions.html" target="blank">http://phpunit.de/manual/</a>
					</section>
					<section>
						<h4>Oefeningen deel 1: story 2</h4>
						<ul>
						<li>maak een <span class="inlinecode">function</span> op Empire, '<strong>convert($jedi)</strong>'<br/>&nbsp;&nbsp;&nbsp;Wat zou dit volgens u moeten doen?</li>
						<li>maak een <span class="inlinecode">function</span> op Jedi, '<strong>equip($saber)</strong>'. <br/>&nbsp;&nbsp;&nbsp;Wat zou dit volgens u moeten doen?</li>
						<li>Vergeet niet de testen uit te breiden!</li>
						</ul>
					</section>
					<section>
						<h4>Oefeningen deel 1 - discussie</h4>
						<ul>
						<li>Zijn alle testen <span style="color: lightgreen;">nog groen</span>? Heb je er <strong>bijgeschreven</strong>?</li>
						<li>Naamgeving - ook doorgevoerd in testen?</li>
						<li>Onthou principes voor volgende oefeningen!</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h4>3. Scoping - poging 1</h4>
						<pre><code>

	public class BookRepository {
		public $db;
		public $bookCache = [];
	}

	$bookRepositoryInstance->db->query('where isOverdue = TRUE');
						</code></pre>
					</section>
					<section>
						<h4>3. Scoping - poging 2</h4>
						<pre><code>
public class BookRepository {
	private $db;
	public function getOverdueBooks() {
		return $db->query('where isOverdue = TRUE');
	}
}

$bookRepositoryInstance->getOverdueBooks();
						</code></pre>
					</section>

				</section>
				<section>
					<h4>3. Scoping - global #fail</h4>
					<pre><code>
$checkoutDate = NULL;
function isOverdue($book) {
	global $checkoutDate;
	// some domain logic here
	$checkoutDate = new Date();
}

$book->setCheckoutDate($checkoutDate); 
					</code></pre>

					<p>
					Zie ook <span class="inlinecode">static</span> e.a.
					</p>
				</section>
				<section>
					<section>
						<h4>4. OO design - poging 1</h4>

						<pre><code>
	$bookid = $_POST['bookid'];
	function prolong($book, $date, $person) {
			$book->checkOutDate = $date;
			$person->bookList->push($book);
		}
	}
	prolong($db->getby($bookid), $_POST['date'], $person);

	echo "<html><body>thank you it has been prolonged</body></html>"

						</code></pre>
					</section>
					<section>
						<h4>4. OO design - poging 2</h4>
						<pre><code>
	class Book {
		function prolong($date, $person) {
			$person->addToBookList($this);
		}
	}
	$book = new Book();
	$book->prolong($_POST['date'], $person);
	$view->renderThankYouPage();
						</code></pre>					

						<pre><code>
	class BookTest extends PHPUnit_Framework_TestCase {
		public void testProlongAddsToPersonBookList() {
			// ...
		}
	}
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h4>4. OO design: polymorphism - poging 1</h4>
						<pre><code>
	function getAisle($book) {
		switch($book->type) {
			case 'nonficition': return 400;
			case 'fiction': return 234;
		}
	}

	getAisle({ type: 'nonfiction' });
						</code></pre>
					</section>
					<section>
						<h4>4. OO design: polymorphism - poging 2</h4>
						<pre><code>
	abstract class Book {
		abstract public function getAisle();
	}
	class FictionBook extends Book {
		function getAisle() {
			return 234;
		}
	}
	class NonFictionBook extends Book {
		function getAisle() {
			return 400;
		}	
	}

	new NonFictionBook()->getAisle();
						</code></pre>					
					</section>
				</section>
				<section data-background="img/trainwreck.gif">
					<h4>4. OO design; Trainwrecks</h4>

					<pre><code>
$repository->getBookById(124)->getAuthor()->getAllBooks()->filterByName('train');
					</code></pre>

				</section>
				<section>
					<section>
						<h4>4. OO design; Error handling - poging 1</h4>
						<pre><code>
	function getBookById($id) {
		if($id == NULL) return -1;

		return $db->getById($id);
	}
						</code></pre>
					</section>
					<section>
						<h4>4. OO design; Error handling - poging 2</h4>
						<pre><code>
function getBookById($id) {
	if($id == NULL) throw new InvalidIdException("id cannot be null!");

	return $db->getById($id);
}
						</code></pre>
					</section>
				</section>

				<section>
					<h4>Refactoring</h4>
					<p>Structuur veranderen, zonder inhoud te wijzigen!</p>
					<img src="img/refactoring.jpg"/>
				</section>

				<section>
					<section data-background="img/lab2.jpg">
						<h2>Oefeningen deel 2</h2>
					</section>

					<section>
						<h4>Dierentuin - story 1</h4>

						<ul>
						<li>maak een <strong>Dierentuin</strong> class</li>
						<li>kan verschillende <strong>Dieren</strong> (<span class="inlinecode">class</span>) <strong>ontvangen</strong> (<span class="inlinecode">function</span>)</li>
						<li>elk dier heeft een <strong>grootte</strong> en <strong>naam</strong>: <br/>Neushoorn (40), Giraf(25), Poema (10)</li>
						<li>elke dierentuin heeft x <i>beschikbareRuimte</i> afhankelijk van <i>grootte</i> van het dier<br/>wat doe je bij het ontvangen van een te groot dier?
						</ul>

						<pre><code>
class Dierentuin {
	public function bezoek() {
		// return [] of dieren
	}
	public function ontvangDier($dier) {
		// ??
	}
}
						</code></pre>
					</section>

					<section>
						<h4>Dierentuin - story 2</h4>

						<ul>
						<li><strong>voeder</strong> functie op dierentuin<br/>
						return <span class="inlinecode">TRUE</span> of <span class="inlinecode">FALSE</span> indien genoeg voedsel voor elk ontvangen dier in de tuin</li>
						<li>voedsel heeft een <strong>voedingswaarde</strong><br/>
						Elk dier eet even veel waarde als zijn grootte</li>
						<li>Verzin voedsel implementaties om alle edge cases te kunnen testen!</li>
						</ul>

						<pre><code>
class Dierentuin {
	public function voeder($voedsel) {
		return TRUE;	// ??
	}
}
						</code></pre>

					</section>
					<section>
						<h4>Dierentuin - discussie</h4>

						<ul>
						<li>Polymorfisme niet vergeten?</li>
						<li>Genoeg testen geschreven voor elk geval?</li>
						<li>Exceptions gebruikt ipv return code?</li>
						</ul>
					</section>

				</section>

				<section>
					<h4>Het pareto principe</h4>
					<strong>80%</strong> van het werk, met<br />
					<strong>20%</strong> van de inspanning

					<blockquote>
						You cannot write perfect software. Therefore,
						do not waste energy trying;
						<br/>be pragmatic.
					</blockquote>
				</section>
				<section>
					<h4>DRY: Don't Repeat Yourself</h4>

					<blockquote>
 "Every piece of knowledge must have a
single, unambiguous, authoritative
representation within a system."						
					</blockquote>
				</section>

				<section>---- DAG 2 ----</section>

				<section>
					<h2>Clean code deel 3: <br/>Unit testing</h2>
					<img src="img/nunit.png"/>
				</section>
				<section>

					<section>
						<h4>Waarom unit testen?</h4>
                        <img src="img/waaromunittesten.jpg" />
					</section>

					<section>
						<h4>Waarom unit testen?</h4>
						<ul>
						<li><strong>feedback!</strong></li>
						<li>Denk in code vanuit API standpunt</li>
						<li>Makkelijk voor pair om te volgen</li>
						<li>Alle mogelijke paden gedekt</li>
						</ul>
					</section>
				</section>
				<section>
					<h4>Eigenschappen van een goede test</h4>
					<ul>
					<li>Ontdek sneller bugs</li>
					<li>Leesbaar</li>
					<li>Geautomatiseerd</li>
					<li>Snel &amp; gefocuset</li>
					<li>Herhaalbaar</li>
					<li>Volgorde onafhankelijk</li>
					<li>Productie code makkelijker wijzigbaar</li>
					</ul>
				</section>
				<section><h4>Eigenschappen van een goede test<br/>
				Geautomatiseerd</h4>
				<img src="img/teamcity.png"/>
				</section>
				<section><h4>Eigenschappen van een goede test<br/>
				"living documentation"</h4>
				<img src="img/livingdocumentation.png"/>
				</section>
				<section>
					<h4>Test Driven Development (TDD)</h4>
					<img src="img/tdd.png"/>
				</section>
				<section data-background="img/abugslife.jpg">
					<h4>TDD: "bugfix" edge case</h4>
					live demo
				</section>
				<section>
					<section>
						<h4>Soorten testen</h4>
						<p>&nbsp;</p>
						<div style="padding-left: 300px;">
							<div style="width: 100px; background-color: red; margin-left: 125px;">E2E</div>
							<div style="width: 250px; background-color: orange; margin-left: 50px;">Integration</div>
							<div style="width: 350px; background-color: green">Unit</div>
						</div>
					</section>
					<section>
						<h4 style="background-color: green">unit testing</h4>
						<ul>
						<li>Onafhankelijk van externen (db, webservice, ...)</li>
						<li>Snel!</li>
						<li>Véél testen</li>
						<li>Test normaal pad &amp; limieten</li>
						<li>"actieve vijand van de code"</li>
						</ul>
					</section>
					<section>
						<h4 style="background-color: orange">integration testing</h4>
						<ul>
						<li>Test geïntegreerd met externen (db, webservice, ...)</li>
						<li>Test integratie <strong>twee verschillende lagen</strong></li>
						<li>Trager dan unit tests</li>
						<li>Minder test cases</li>
						</ul>
					</section>
					<section>
						<h4 style="background-color: red">end to end testing</h4>
						<ul>
						<li>Test hele applicatie!</li>
						<li>niet alle limieten</li>
						<li>traag, moelijker onderhoudbaar</li>
						<li>Test integratie <strong>alle</strong> lagen</li>
						</ul>
					</section>

				</section>
				<section>
					<section data-background="img/spreadsheet.jpg">
						<h2 style="color: black;">OEFENING:<br/>SPREADSHEET</h2>
					</section>
					<section>
						<h4>Story 1: simple spreadsheet</h4>

						<ul>
						<li>Onbeperkt aantal rijen/kolommen</li>
						<li>Rij = nummer 1 -> 9999...</li>
						<li>Kolom = Cijfer A -> Z, AA -> ZZ, ...</li>
						<li>Cellen zijn standaard leeg ("")</li>
						<li>Cellen kunnen tekst opslaan</li>
						<li>Mogelijk om inhoud van cel uit te lezen</li>
						</ul>
					</section>
					<section>
						<h4>Story 2: numerics and literal values</h4>

						<ul>
						<li><strong>Numerische</strong> cellen worden automatisch herkend:<br/>
						Tekst "  124  " (met spaties) wordt het getal 124 (zonder spaties)</li>
						<li>Mogelijk om <strong>literaire</strong> inhoud van cel uit te lezen<br/>
						Cel met tekst "  124  " heeft literaire waarde "  124  " en waarde 124</li>
						</ul>
					</section>
					<section>
						<h4>Story 3: Formulas</h4>

						<ul>
						<li>"=234" is een formule, " =234" (spatie) is tekst</li>
						<li>Waarde van formule "=234" is het getal 234. Literaire waarde = de formule</li>
						<li>Soorten:
							<ol>
							<li>Constanten =124</li>
							<li>Met haakjes =((124))</li>
							<li>Simpele berekeningen =3+5, =5-3, =4*2</li>
							<li>Complexe berekeningen =7*(2+3)*((((2+1))))</li>
							</ol>
						</ul>
					</section>
					<section>
						<h4>Story 3: Formulas - berekeningen</h4>

						<pre><code>
	public function testFormula_evaluatesSimpleCalculation() {
		$formula = "3+5";

		$this->assertEquals(8, eval('return ' . $formula . ';'));
	}

						</code></pre>

						Gebruik <strong>nooit</strong> <span class="inlinecode">eval()</span> in productiecode!<br/>
						Waarom niet?
					</section>
					<section>
						<h4>Story 4: Formula errors</h4>

						Wanneer een formule een fout bevat, moet de waarde van de cel "<strong>#ERROR</strong>" zijn.

						<br/><br/>

						bvb. <span class="inlinecode">=((124)-())</span> of <span class="inlinecode">=7*</span> of delen door 0.
					</section>
					<section>
						<h4>Story 5: dependencies</h4>

						<span class="inlinecode">=A2</span><br/><br/>
						<ul>
						<li>Waarde = waarde van cel waar je naar verwijst.</li>
						<li>Indien waarde A2 verandert, verandert deze cel ook.</li>
						<li>Referenties naar referenties = mogelijk! A1 -> A2 -> A3</li>
						<li>Circulaire referneties vermijden.<br/>
						 Geef "<strong>#CIRCULAR</strong>" fout als waarde.</li>
						</ul>

					</section>
					<section>
						<h4>Story 6: Functions</h4>

						<ul>
						<li><span class="inlinecode">Sum(range)</span><br/>
						Bijvoorbeeld <span class="inlinecode">=SUM(A1:A6)</span></li>
						<li><span class="inlinecode">Average(range)</span><br/>
						Bijvoorbeeld <span class="inlinecode">=AVG(A1:D1)</span></li>
						</ul>
					</section>
					<section>
						<h4>Spreadsheet - discussie</h4>

						<ul>
						<li>Genoeg testen geschreven voor elk geval?</li>
						<li>Exceptions gebruikt ?</li>
						<li>Is je code leesbaar voor je buurman?</li>
						<li>Was dit makkelijker met focus op schrijven van testen of niet?</li>
						</ul>					
					</section>
				</section>

				<section>
					<h2>DAG 3</h2>

					<img src="img/timespent.jpg" alt="time spent by programmers at work"/>
				</section>

				<section>
					<h2>Clean code herhaling (JS):<br/>principes</h2>
					<blockquote>
						Programmers are really authors, and your target audience is not the computer it is other programmers (and yourself). 
					</blockquote>					
				</section>

				<section data-background="img/cleanfail.gif">
					&nbsp;
				</section>

				<section>
					<h4>1. Naamgeving: methods/variabelen</h4>

					<pre><code>
	function render() {
		renderRest();
	}
	function renderRest() {
		document.getElementById('#ak').innerHTML = 'wow';
	}
					</code></pre>
				</section>

				<section>
					<h4>2. Functies: verantwoordelijkheden</h4>

					<pre><code>
	function getBodyElements() {
		return document.querySelector('.body').forEach(function(i) {
			bodies++;	// ???
		});
	}
					</code></pre>
					VS

					<pre><code>
	function getBodyElements() {
		return documents.querySelector('.body');
	}
	function getAmountOfBodyElements() {
		return getBodyElements().length;
	}
					</code></pre>
				</section>

				<section>
					<h4>2. Functies: argumenten</h4>
					<pre><code>
	function prolongBook() {
		if(arguments[1]) {
			var overdue = true;
		}
		if(arguments[0]) {
			arguments[0].prolong(overdue);
		}
	}
					</code></pre>
					VS

					<pre><code>
	function prolongBook(book, isOverdue) {
		// ...
	}
					</code></pre>
				</section>

				<section>
					<h4>2. Functies: Side effects</h4>
					<pre><code>
	function renderContentCallback() {
		if(!this.rendered) {
			reRenderContent();
		}
		this.rendered = true;
	}
					</code></pre>

					Zelfde principe in elke taal...
				</section>

				<section>
					<h4>2. Functies - als prototypal extension</h4>

					<pre><code>
	String.prototype.capitalize = function() {
		return this[0].toUpperCase() + this.substring(1, this.length);
	};

	expect("blabla".capitalize()).toEqual("Blabla");
					</code></pre>

					<p>
						Is dit duidelijk voor uw mede developers? <br/>
						Je hebt JS core functionaliteit uitgebreid!
					</p>

					<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank">MDN inheritance docs</a>
				</section>


				<section>
					<section>
						<h4>3. Scoping - poging 1</h4>

						<pre><code>
	var obj = {
		isRendered: false,

		render: function() {
			if(!this.isRendered) {
				refresh();
			}
			this.isRendered = true;
		}
	};
						</code></pre>

						Is <span class="inlinecode">isRendered</span> voldoende afgeschermd?
					</section>

					<section>
						<h4>3. Scoping - poging 1</h4>
						Het antwoord is <strong>Neen</strong>:<br/><br/>

						<ol>
						<li><span class="inlinecode">delete obj.isRendered</span> en *POOF*</li>
						<li><span class="inlinecode">obj.isRendered = true</span> en *POOF*</li>
						</ol>
					</section>

					<section>
						<h4>3. Scoping - poging 2</h4>

						<pre><code>
	obj = (function() {
		var isRendered = false;
		var render = function() {
			// ...
		}

		return {
			render: render
		};
	})();
						</code></pre>
					</section>

					<section>
						<h4>3. Scoping - poging 2</h4>

						<pre><code>
	(function() {
		// niemand kan aan mij! FUNCTION LEVEL SCOPE
	})();
						</code></pre>
						Expose enkel wat jij wil als publieke interface:

						<pre><code>
	myAPI = (function() {
		return {
			// enkel DIT is aanspreekbaar
		};
	})();
						</code></pre>
					</section>

					<section>
						<h4>3. Scoping</h4>

						Pas op met PHP! 

						<pre><code>
	function main() {
	    if (TRUE) {
	        $i = 3;
	    }
	    echo $i;
	}
	main();			// wat doet dit?
						</code></pre>
						Waarom?
					</section>
					<section>
						<h4>3. Scoping</h4>

						Pas op met Javascript! 

						<pre><code>
	var main = function () {
	    if (true) {
	        var i = 3;
	    }
	    console.log(i);
	}
	main();			// wat doet dit?
    				</code></pre>
    				wordt door interpreter dit:

						<pre><code>
	var main = function () {
		var i = undefined;
	    if (true) {
	        i = 3;
	    }
	    console.log(i);
	}
    				</code></pre>

                    </section>
                    <section>
                        <h4>3. Scoping</h4>
						</code></pre>

						VS een taal als C:

						<pre><code>
	void main() {
	    if (true) {
	        int i = 3;
	    }
	    printf("%d", i);	// wat doet dit?
	}
						</code></pre>

						Waarom? Statisch getypeerd!
					</section>
				</section>
				<section>
					<h4>3. Scoping - global #fail</h4>

					<pre><code>
	function calculateBookPrice() {
		discount = 10;	// oops??
		return this.basePrice + calculateOverduePrice() - discount;
	}
					</code></pre>

					Wat is de waarde van <span class="inlinecode">window.discount</span>?
				</section>

				<section>
					<h4>3. Scoping - Mix/machting tags</h4>

					<pre><code>
<?php
echo "<table&gt;";
echo "<tr&gt;<td&gt;";
echo "Hai welcome to php";
echo "</td&gt;</tr&gt;";
echo "</table&gt;"; 
?>
					</code></pre>
VS
					<pre><code>
<table>
<tr><td>
	<?php echo "Hai welcome to php"; ?>
</td></tr>
</table>					
					</code></pre>

					Pear PHP standaarden:<br/>
					<a href="http://pear.php.net/manual/en/standards.php" target="_blank">http://pear.php.net/manual/en/standards.php</a>
				</section>

				<section>
					<section>
						<h4>4. OO design - poging 1</h4>

						<pre><code>

	var bookid = document.querySelector('#bookid').innerHTML;
	var prolong = function(book, date, person) {
			book.checkOutDate = date;
			person.bookList.push(book);
		}
	};
	doAjaxCall('getBookById.json', bookid, function(book) {
		prolong(book, someDate, person);
	});
	document.querySelector('#messages').innerHTML = "thank you";

						</code></pre>
						Wat gaat er mis?
					</section>
					<section>
						<h4>4. OO design - poging 2</h4>
						<pre><code>
	// ------ domain/book.js ------ 
	var Book = {
		prolong: function(date, person) {
			person.addToBookList(this);
		}
	};
	// ------ controller/bookid.js ------
	var bookid = view.getBookId();
	doAjaxCall('getBookById.json', bookid, function(book) {
		book.prolong(someDate, person);
	});
	view.renderThankYouPage();
						</code></pre>
						Wat gaat er mis?
					</section>
					<section>
						<h4>4. OO design - poging 3</h4>
						<pre><code>
	doAjaxCall('getBookById.json', bookid, function(book) {
		book.prolong(someDate, person);
		view.renderThankYouPage();
	});
						</code></pre>
					</section>
					<section>		
						<h4>4. OO design - Testen!</h4>			
						<pre><code>
	describe("Book tests", function() {
	  it("should add book to person list", function() {
	  	var book = Object.create(Book);
	  	book.prolong(someDate, person);

	    expect(person.getBookList()).toContain(book);
	  });
	});						
						</code></pre>
					</section>
					<section>
						<h4>4. OO design</h4>

						<p>
							Héél belangrijk in goed onderhoudbare JS code:
						</p>

						<p>
							<ol>
							<li>Scheiding domein/callbacks - async stuff</li>
							<li>Scheiding domein/front - DOM manipulatie</li>
							<li>Scheiding domein/frameworks - niet (makkelijk) testbaar!</li>
							</ol>
						</p>

						<p>
							Moeilijk testbare code => beter eerst testen geschreven??
						</p>
					</section>
				</section>

				<section>
					<section>
						<h4>Unit testing in JS</h4>
						<p>
							<a href="http://jasmine.github.io/2.5/introduction.html" target="_blank"><img src="img/jasmine-horizontal.png" alt="jasmine logo" /></a>
						</p>

						<pre><code>
		describe("A suite", function() {
		  it("contains spec with an expectation", function() {
		    expect(true).toBe(true);
		  });
		});
						</code></pre>

						Beschrijft <strong>gedrag</strong>
					</section>
					<section>
						<h4>Test Driven Development (TDD)<br/>remember?</h4>
						<img src="img/tdd.png"/>
					</section>
					<section data-background="img/abugslife.jpg">
						<h4>TDD: "bugfix" edge case</h4>
						live demo - remember "Period"?
					</section>
				</section>

				<section>
					<section data-background="img/lab3.jpg">
						<h2>Oefening - Dierentuin HERWERKEN IN JS</h2>
					</section>

					<section>
						<h4>Dierentuin - story 1 - remember?</h4>

						<ul>
						<li>maak een <strong>Dierentuin</strong> object</li>
						<li>kan verschillende <strong>Dieren</strong> (<span class="inlinecode">object</span>) <strong>ontvangen</strong> (<span class="inlinecode">function</span>)</li>
						<li>elk dier heeft een <strong>grootte</strong> en <strong>naam</strong>: <br/>Neushoorn (40), Giraf(25), Poema (10)</li>
						<li>elke dierentuin heeft x <i>beschikbareRuimte</i> afhankelijk van <i>grootte</i> van het dier<br/>wat doe je bij het ontvangen van een te groot dier?
						</ul>

						<pre><code>
var Dierentuin = {
	bezoek: function() {
		// return [] of dieren
	}
	ontvangDier: function(dier) {
		// ??
	}
}
						</code></pre>
					</section>

					<section>
						<h4>Dierentuin - story 2</h4>

						<ul>
						<li><strong>voeder</strong> functie op dierentuin<br/>
						return <span class="inlinecode">true</span> of <span class="inlinecode">false</span> indien genoeg voedsel voor elk ontvangen dier in de tuin</li>
						<li>voedsel heeft een <strong>voedingswaarde</strong><br/>
						Elk dier eet even veel waarde als zijn grootte</li>
						<li>Verzin voedsel implementaties om alle edge cases te kunnen testen!</li>
						</ul>

						<pre><code>
var Dierentuin = {
	voeder: function(voedsel) {
		return true;	// ??
	}
}
						</code></pre>

					</section>
					<section>
						<h4>Dierentuin - story 3</h4>

						<p>
							Hoe los je inheritance op in JS? (Een Neushoorn is een Dier)
						</p>

						<pre><code>
var Dier = { };
var Neushoorn = Object.create(Dier);
var eenNeushoorn = Object.create(Neushoorn, { grootte: { value: 10 } });
						</code></pre>

						Want:

						<pre><code>
it("should inerit each other", function() {
	expect(Object.getPrototypeOf(Dier)).toBe(Object.prototype);
	expect(Object.getPrototypeOf(Neushoorn)).toBe(Dier);
	expect(Object.getPrototypeOf(eenNeushoorn)).toBe(Neushoorn);
});
						</code></pre>
						Herwerk je code!<br/>
						<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank">Zie Mozilla Developer Network</a>.
					</section>
					<section>
						<h4>Dierentuin - discussie</h4>

						<ul>
						<li>Hoe heb je je objecten als instanties aangemaakt?</li>
						<li>Genoeg testen geschreven voor elk geval?</li>
						<li>Was dit makkelijk van PHP naar JS over te zetten?</li>
						<li>Gedacht aan scoping?</li>
						</ul>
					</section>
				</section>
				<section>
					<h2>JS Resources</h2>

					<p>
					Eerst leren kruipen, dan lopen!
					</p>

					<img src="img/jsthegoodparts.jpg"/>
				</section>
				<section data-background="img/fail.jpg">
					&nbsp;
				</section>

				<section>
					<section>
						<h4>Soorten testen - remember?</h4>
						<p>&nbsp;</p>
						<div style="padding-left: 300px;">
							<div style="width: 100px; background-color: red; margin-left: 125px;">E2E</div>
							<div style="width: 250px; background-color: orange; margin-left: 50px;">Integration</div>
							<div style="width: 350px; background-color: green">Unit</div>
						</div>
					</section>

					<section>
						<h4 style="background-color: orange">integration testing - remember?</h4>
						<ul>
						<li>Test geïntegreerd met externen (db, webservice, ...)</li>
						<li>Test integratie <strong>twee verschillende lagen</strong></li>
						<li>Trager dan unit tests</li>
						<li>Minder test cases</li>
						</ul>
					</section>
					<section>
						<h4 style="background-color: orange">integration testing - hoe één stukje testen?</h4>

						<pre><code>
	var Book = {
		prolong: function(person) {
			var date = Date.now();
			this.dbHandle.prolong(date, person.id);
		}
	};
						</code></pre>

						Ik heb <span class="inlinecode">dbHandle.prolong()</span> apart getest, wat nu?
					</section>
					<section>
						<h4 style="background-color: orange">integration testing - hoe één stukje testen?</h4>						

						<p>
							Injecteer een andere dbHandle: een "<strong>mock</strong>".
						</p>

						<pre><code>
 	var book = Object.create(Book);
 	book.dbHandle = {
 		prolong: function(date, personId) {
 			// Captured arguments! Assert stuff here
 		}
 	};
						</code></pre>
					</section>
					<section>
						<h4 style="background-color: orange">integration testing - met Jasmine</h4>						


						<p>
						Laat Jasmine "spies" aanmaken<br/>
						<a href="http://jasmine.github.io/2.5/introduction.html#section-Spies" target="_blank">http://jasmine.github.io/2.5/introduction.html#section-Spies</a>
						</p>

						<pre><code>
it("should call prolong from repository", function() {
	var dbHandle = jasmine.createSpyObj('dbHandle', ['prolong']);
	book.dbHandle = dbHandle;
	book.prolong(person);

	expect(dbHandle.prolong).ToHaveBeenCalledWith(
		jasmine.any(Date), 
		person.id);
});
						</code></pre>
					</section>
					<section>
						<h4 style="background-color: orange">integration testing - met PHPUnit</h4>
						<p><a href="https://phpunit.de/manual/current/en/test-doubles.html" target="_blank">https://phpunit.de/manual/current/en/test-doubles.html</a></p>

						<pre><code>
    public function testStub()
    {
        $mock = $this->createMock(SomeClass::class);
        $mock->method('doSomething')->willReturn('foo');

        $this->assertEquals('foo', $mock->doSomething());
    }
						</code></pre>
					</section>

					<section>
						<h4 style="background-color: orange">integration testing - in Symfony</h4>

						<p>
						Welke stukken kan ik op die manier testen...<br/>
						in een <strong>Symfony</strong> project?<br/><br/>

						<img src="img/symfony.png" alt="symfony logo"/>
						</p>
					</section>

					<section>
						<h4 style="background-color: orange">integration testing - in Symfony</h4>

						<ul>
						<li>De entityManager <span class="inlinecode">ObjectManager</span> klasse</li>
						<li>Stukjes domein logica uit controllers halen die elders getest zijn</li>
						<li>...</li>
						</ul>

						<pre><code>
      $bookRepositoryMock = $this->getMockBuilder(EntityRepository::class)
            ->disableOriginalConstructor()
            ->getMock();
      $bookRepositoryMock->expects($this->once())
            ->method('find')
            ->will($this->returnValue($book));

     $bookController = new BookController($bookRepositoryMock);
						</code></pre>

						<a href="http://symfony.com/doc/current/testing/database.html" target="_blank">http://symfony.com/doc/current/testing/database.html</a>
					</section>

				</section>

				<section>
					<section data-background="img/codereview.jpg">
						<h2>Oefening - CODE REVIEWS</h2>
					</section>
					<section>
						<h4>Code reviews</h4>

						<ul>
						<li><strong>switch computers!</strong></li>
						<li>Zoek actief naar stukken die <strong>goed</strong> en <strong>minder</strong> zijn.<br/>Denk aan clean code &amp; unit testen!</li>
						<li>Nog <strong>geen code wijzigen</strong>!</li>
						<li>Neem de tijd om alles onder de loep te nemen, incl testen.</li>
						<li>Noteer in een open <strong>NOTEPAD</strong> scherm: <strong>+ WAAROM?</strong></li>
						</ul>
					</section>

					<section>
						<h4>Code reviews - discussie</h4>

						<ul>
						<li>Wie heeft de unit testen bekeken?<br/>Ontbreken er een aantal?</li>
						<li>Wie heeft de applicatie daadwerkelijk gebruikt als eindgebruiker?</li>
						<li>Wie heeft ook gelet op functionele vereisten die ontbreken?</li>
						</ul>
					</section>
				</section>

				<section>
					<blockquote>
						"Programmers should avoid writing code that looks like <span class="inlinecode" style="border: 1px dotted orange;">dog.getBody().getTail().wag();</span><br/>
						The solution is to rewrite our example as <span class="inlinecode" style="border: 1px dotted lightgreen;">dog.expressHappiness();</span> <br/>and let the implementation of the dog 
						decide what this means."
					</blockquote>
				</section>

				<section>
					<h2>het 'DRY' principe</h2>

					<blockquote>
						<strong>D</strong>on't<br/>
						<strong>R</strong>epeat<br/>
						<strong>Y</strong>ourself!
					</blockquote>

					<p>
						Anders gezegd zijnde: <br/>
						"Duplication is the root of all evil"
					</p>
				</section>

				<section>
					<h2>het 'YAGNI' principe</h2>

					<blockquote>
						<strong>Y</strong>ou<br/>
						<strong>A</strong>int<br/>
						<strong>G</strong>onna<br/>
						<strong>N</strong>eed<br/>
						<strong>I</strong>t
					</blockquote>

					<p>
						Anders gezegd zijnde: <br/>
						Schrap "Als dit er ooit komt en in geval van x..."
					</p>
				</section>

				<section data-background="img/codereview.jpg">
					<h2>Oefening - REFACTOR NA REVIEW</h2>
				</section>

				<section data-background="img/thatsall.png">
					
				</section>
				<section>
					<blockquote style="background-color: white;">
						<img src="img/logo.png"/>
					</blockquote>				
					<a href="http://www.prato.be" target="_blank">http://www.prato.be</a><br/>
					<a href="mailto:vacatures@prato.be">vacatures@prato.be</a>
				</section>

				<section>
					<h2>Resources</h2>

					<span style="font-size: 16pt;">
					<ul>
					<li><a href="https://github.com/wgroeneveld/cleancode-course">https://github.com/wgroeneveld/cleancode-course</a></li>
					<li><a href="http://www.inf.fu-berlin.de/inst/ag-se/teaching/K-CCD-2014/Clean-Code-summary.pdf">The Essence of clean code</a></li>
					<li><a href="http://www.inf.fu-berlin.de/inst/ag-se/teaching/K-CCD-2014/Pragmatic-Programmer-summary.pdf">The Essence of pragmatic programmer</a></li>
					<li><a href="https://blog.codinghorror.com/a-pragmatic-quick-reference/">A pragmatic programmer Quick reference card</a></li>
					</ul>

					<img src="img/cleancode.jpg"/>
				</span>
				</section>

			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

			document.querySelectorAll('code').forEach(function(block) {
				block.className =  block.className + ' php';
			});
		</script>
	</body>
</html>
